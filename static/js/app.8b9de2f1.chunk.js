(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[115],{252:function(e,a,t){},254:function(e,a,t){},255:function(e,a,t){},349:function(e,a,t){},350:function(e,a,t){},351:function(e,a,t){},353:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(207),c=t(227),s=t(250);t(251);var o,i,u,b,E,v,d=t(15),O=t(211),h=t(4),p=t.n(h),A=(o={},Object(d.a)(o,"FAVORITE_VIEWS",{value:"FAVORITE_VIEWS",label:p.a.t("Favorite views"),subtitle:p.a.t("Number of times users looked at analysis favorites")}),Object(d.a)(o,"FAVORITES_SAVED",{value:"FAVORITES_SAVED",label:p.a.t("Favorites saved"),subtitle:p.a.t("Number of analysis favorites created by users")}),Object(d.a)(o,"USERS",{value:"USERS",label:p.a.t("Users"),subtitle:p.a.t("Number of users in the system")}),Object(d.a)(o,"TOP_FAVORITES",{value:"TOP_FAVORITES",label:p.a.t("Top favorites")}),Object(d.a)(o,"DATA_VALUES",{value:"DATA_VALUES",label:p.a.t("Data values"),subtitle:p.a.t("Number of data values saved in the system")}),o),g=(i={},Object(d.a)(i,"DAY",{value:"DAY",label:p.a.t("Day")}),Object(d.a)(i,"WEEK",{value:"WEEK",label:p.a.t("Week")}),Object(d.a)(i,"MONTH",{value:"MONTH",label:p.a.t("Month")}),Object(d.a)(i,"YEAR",{value:"YEAR",label:p.a.t("Year")}),i),y=(u={},Object(d.a)(u,"SUM",{value:"SUM",label:p.a.t("Sum")}),Object(d.a)(u,"AVERAGE",{value:"AVERAGE",label:p.a.t("Average")}),u),m=(b={},Object(d.a)(b,"ALL",{value:"ALL",label:p.a.t("All")}),Object(d.a)(b,"TOTAL",{value:"TOTAL",label:p.a.t("Total")}),b),f=(E={},Object(d.a)(E,"CHART_VIEW",{value:"CHART_VIEW",label:p.a.t("Chart")}),Object(d.a)(E,"MAP_VIEW",{value:"MAP_VIEW",label:p.a.t("Map")}),Object(d.a)(E,"REPORT_TABLE_VIEW",{value:"REPORT_TABLE_VIEW",label:p.a.t("Report table")}),Object(d.a)(E,"EVENT_REPORT_VIEW",{value:"EVENT_REPORT_VIEW",label:p.a.t("Event report")}),Object(d.a)(E,"EVENT_CHART_VIEW",{value:"EVENT_CHART_VIEW",label:p.a.t("Event chart")}),Object(d.a)(E,"DASHBOARD_VIEW",{value:"DASHBOARD_VIEW",label:p.a.t("Dashboard")}),Object(d.a)(E,"DATA_SET_REPORT_VIEW",{value:"DATA_SET_REPORT_VIEW",label:p.a.t("Data set report")}),E),D=(v={},Object(d.a)(v,"ASC",{value:"ASC",label:p.a.t("Ascending")}),Object(d.a)(v,"DESC",{value:"DESC",label:p.a.t("Descending")}),v);function T(e){var a=new Date(e.valueOf());return a.setMonth(a.getMonth()-4),{category:"FAVORITE_VIEWS",startDate:R(a),endDate:R(e),interval:"WEEK",aggregationLevel:"SUM",chartType:"ALL",eventType:"CHART_VIEW",pageSize:"25",sortOrder:"ASC"}}function R(e){var a=e.getFullYear(),t=""+(e.getMonth()+1),n=""+e.getDate();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}var S=[s.a];var j=Object(c.c)({appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type;switch(t){case"APP_LOAD_SUCCESS":return"READY";case"APP_LOAD_ERROR":return"ERROR";default:return e}},usageData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"USAGE_DATA_REQUESTED":return"LOADING";case"APP_LOAD_SUCCESS":case"USAGE_DATA_RECEIVED":return n;case"USAGE_DATA_ERRORED":return"ERROR";default:return e}},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T(new Date),a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"FILTER_UPDATED":return Object(O.a)({},e,Object(d.a)({},n.key,n.value));default:return e}}}),V=Object(c.d)(j,c.a.apply(void 0,S)),_=t(8),C=t(12),k=t(14),I=t(11),w=t(13),F=t(42),L=t(199),P=t(16),U=t.n(P);var N="".concat("..","/api"),W={method:"GET",credentials:"include"};function M(e){return function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;return e?fetch("".concat(N,"/").concat(e),a).then((function(e){if(e.ok)return e;throw new Error(e.statusText)})):Promise.reject(new Error("A path must be passed"))}(e).then((function(e){return e.json()})).then((function(e){if("ERROR"===e.status)throw new Error(e.message);return e}))}function G(e){return"TOP_FAVORITES"===e.category?function(e){var a=e.eventType,t=e.pageSize,n=e.sortOrder,r="eventType=".concat(a,"&pageSize=").concat(t,"&sortOrder=").concat(n,"&_=").concat(Date.now());return M("dataStatistics/favorites?".concat(r))}({eventType:e.eventType,pageSize:e.pageSize,sortOrder:e.sortOrder}):function(e){var a=e.startDate,t=e.endDate,n=e.interval,r="startDate=".concat(a,"&endDate=").concat(t,"&interval=").concat(n,"&_=").concat(Date.now());return M("dataStatistics?".concat(r))}({startDate:e.startDate,endDate:e.endDate,interval:e.interval})}var x=function(e){return function(a,t){var n=t().filter,r=n.category;if(a(z("category",e)),function(e,a){return e!==a&&("TOP_FAVORITES"===a&&"TOP_FAVORITES"!==e||"TOP_FAVORITES"===e&&"TOP_FAVORITES"!==a)}(r,e))return Y(Object(O.a)({},n,{category:e}),a)}},H=function(e,a){return function(t,n){return t(z(e,a)),Y(n().filter,t)}},z=function(e,a){return B("FILTER_UPDATED",{key:e,value:a})};function Y(e,a){var t;return U.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a(B("USAGE_DATA_REQUESTED")),n.prev=1,n.next=4,U.a.awrap(G(e));case 4:t=n.sent,a(B("USAGE_DATA_RECEIVED",t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),a(B("USAGE_DATA_ERRORED",n.t0));case 11:case"end":return n.stop()}}),null,null,[[1,8]])}function B(e,a){return{type:e,payload:a}}t(252);var K,J=function(e){var a=e.message;return r.a.createElement("div",{className:"uaa-error"},a)},Q=t(244),q=t(354),X=t(352),Z=(K={},Object(d.a)(K,"5",{value:"5",label:"5"}),Object(d.a)(K,"10",{value:"10",label:"10"}),Object(d.a)(K,"15",{value:"15",label:"15"}),Object(d.a)(K,"20",{value:"20",label:"20"}),Object(d.a)(K,"25",{value:"25",label:"25"}),K),$=function(e){var a=e.options,t=e.value,n=Object(Q.a)(e,["options","value"]);return r.a.createElement(q.a,Object.assign({},n,{selected:a[t]}),Object.keys(a).map((function(e){return r.a.createElement(X.a,{label:a[e].label,key:a[e].value,value:a[e].value})})))},ee=t(6),ae=t(202),te=t(253),ne=t.n(te),re=(t(254),p.a.t("Please use the format yyyy-mm-dd")),le=p.a.t("Please fill in both dates"),ce=p.a.t("End date is before start date"),se=p.a.t("Start date is after end date"),oe=function(e){function a(e){var t;return Object(_.a)(this,a),(t=Object(k.a)(this,Object(I.a)(a).call(this,e))).state={startDateError:null,endDateError:null},t.onStartDateChange=t.onStartDateChange.bind(Object(ee.a)(t)),t.onEndDateChange=t.onEndDateChange.bind(Object(ee.a)(t)),t.updateUsageData=ne()(e.updateUsageData,250),t}return Object(w.a)(a,e),Object(C.a)(a,[{key:"onStartDateChange",value:function(e){var a=e.value;this.onChange("startDate",a)}},{key:"onEndDateChange",value:function(e){var a=e.value;this.onChange("endDate",a)}},{key:"onChange",value:function(e,a){var t,n=this.props,r=n.updateFilter,l=Object(Q.a)(n,["updateFilter"]),c="".concat(e,"Error"),s="".concat("startDate"===e?"endDate":"startDate","Error"),o=this.getError(Object(O.a)({},l,Object(d.a)({},e,a)),e),i=this.state[s]===re?re:null;this.state[c]!==o&&this.setState((t={},Object(d.a)(t,c,o),Object(d.a)(t,s,i),t));r(e,a),o||this.updateUsageData()}},{key:"getError",value:function(e,a){return/[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(e[a])?e.startDate&&e.endDate?e.endDate<e.startDate?"startDate"===a?se:ce:null:le:re}},{key:"render",value:function(){var e=this.props,a=e.startDate,t=e.endDate,n=this.state,l=n.startDateError,c=n.endDateError;return r.a.createElement("div",{className:"uaa-date-range"},r.a.createElement(ae.a,{label:p.a.t("Start Date"),type:"date",value:a,onChange:this.onStartDateChange,error:!!l,validationText:l,name:"startDate",className:"startDate",dataTest:"uaa-startdate"}),r.a.createElement(ae.a,{label:p.a.t("End Date"),type:"date",value:t,onChange:this.onEndDateChange,error:!!c,validationText:c,name:"endDate",className:"endDate",dataTest:"uaa-enddate"}))}}]),a}(n.Component),ie=Object(l.b)(pe("category"),{onChange:function(e){var a=e.selected.value;return x(a)}})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Category"),options:A}))})),ue=Object(l.b)((function(e){return{startDate:e.filter.startDate,endDate:e.filter.endDate}}),{updateFilter:z,updateUsageData:function(){return function(e,a){return Y(a().filter,e)}}})(oe),be=Object(l.b)(pe("interval"),{onChange:Ae(H,"interval")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Interval"),options:g}))})),Ee=Object(l.b)(pe("aggregationLevel"),{onChange:Ae(z,"aggregationLevel")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Aggregation Level"),options:y}))})),ve=Object(l.b)(pe("chartType"),{onChange:Ae(z,"chartType")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Chart Type"),options:m}))})),de=Object(l.b)(pe("eventType"),{onChange:Ae(H,"eventType")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Event Type"),options:f}))})),Oe=Object(l.b)(pe("pageSize"),{onChange:Ae(H,"pageSize")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Page Size"),options:Z}))})),he=Object(l.b)(pe("sortOrder"),{onChange:Ae(H,"sortOrder")})((function(e){return r.a.createElement($,Object.assign({},e,{label:p.a.t("Sort Order"),options:D}))}));function pe(e){return function(a){return{label:e,value:a.filter[e]}}}function Ae(e,a){return function(t){var n=t.selected.value;return e(a,n)}}t(255);var ge,ye,me,fe,De,Te,Re=Object(l.b)((function(e){var a=e.filter.category;return{showDateFields:"TOP_FAVORITES"!==a,showTopFavoritesFields:"TOP_FAVORITES"===a,showFavoriteViewsFields:"FAVORITE_VIEWS"===a}}))((function(e){var a=e.showDateFields,t=e.showFavoriteViewsFields,l=e.showTopFavoritesFields;return r.a.createElement("aside",{className:"uaa-filter-sidebar"},r.a.createElement("h1",{className:"uaa-app-header"},p.a.t("Usage Analytics")),r.a.createElement(ie,null),a&&r.a.createElement(n.Fragment,null,r.a.createElement(ue,null),r.a.createElement(be,null)),t&&r.a.createElement(n.Fragment,null,r.a.createElement(Ee,null),r.a.createElement(ve,null)),l&&r.a.createElement(n.Fragment,null,r.a.createElement(de,null),r.a.createElement(Oe,null),r.a.createElement(he,null)))})),Se=t(256),je={key:"date",label:p.a.t("Date")},Ve={key:"mapViews",label:p.a.t("Map")},_e={key:"chartViews",label:p.a.t("Chart")},Ce={key:"pivotTableViews",label:p.a.t("Pivot Table")},ke={key:"eventReportViews",label:p.a.t("Event Report")},Ie={key:"eventChartViews",label:p.a.t("Event Chart")},we={key:"dashboardViews",label:p.a.t("Dashboard")},Fe={key:"dataSetReportViews",label:p.a.t("Data Set Report")},Le={key:"totalViews",label:p.a.t("Total")},Pe={key:"averageMapViews",label:p.a.t("Average Map")},Ue={key:"averageChartViews",label:p.a.t("Average Chart")},Ne={key:"averagePivotTableViews",label:p.a.t("Average Pivot Table")},We={key:"averageEventReportViews",label:p.a.t("Average Event Report")},Me={key:"averageEventChartViews",label:p.a.t("Average Event Chart")},Ge={key:"averageDashboardViews",label:p.a.t("Average Dashboard")},xe={key:"averageViews",label:p.a.t("Average")},He={key:"savedMaps",label:p.a.t("Maps")},ze={key:"savedCharts",label:p.a.t("Charts")},Ye={key:"savedPivotTables",label:p.a.t("Pivot Tables")},Be={key:"savedEventReports",label:p.a.t("Event Reports")},Ke={key:"savedEventCharts",label:p.a.t("Event Charts")},Je={key:"savedDashboards",label:p.a.t("Dashboards")},Qe={key:"savedIndicators",label:p.a.t("Indicators")},qe={key:"activeUsers",label:p.a.t("Active Users")},Xe={key:"users",label:p.a.t("Total Users")},Ze={key:"position",label:p.a.t("Position")},$e={key:"name",label:p.a.t("Name")},ea={key:"views",label:p.a.t("Views")},aa={key:"id",label:p.a.t("ID")},ta={key:"created",label:p.a.t("Created")},na={key:"savedDataValues",label:p.a.t("Data Values")},ra=[Ve,_e,Ce,ke,Ie,we,Fe],la=[Pe,Ue,Ne,We,Me,Ge],ca=[He,ze,Ye,Be,Ke,Je,Qe],sa=[qe,Xe],oa=(ye={},Object(d.a)(ye,"FAVORITE_VIEWS",(ge={},Object(d.a)(ge,"SUM",[je].concat(ra,[Le])),Object(d.a)(ge,"AVERAGE",[je].concat(la,[xe])),ge)),Object(d.a)(ye,"FAVORITES_SAVED",[je].concat(ca)),Object(d.a)(ye,"USERS",[je].concat(sa)),Object(d.a)(ye,"TOP_FAVORITES",[Ze,$e,ea,aa,ta]),Object(d.a)(ye,"DATA_VALUES",[je,na]),ye),ia=(Te={},Object(d.a)(Te,"FAVORITE_VIEWS",(De={},Object(d.a)(De,"SUM",(me={},Object(d.a)(me,"ALL",ra),Object(d.a)(me,"TOTAL",[Le]),me)),Object(d.a)(De,"AVERAGE",(fe={},Object(d.a)(fe,"ALL",la),Object(d.a)(fe,"TOTAL",[xe]),fe)),De)),Object(d.a)(Te,"FAVORITES_SAVED",ca),Object(d.a)(Te,"USERS",sa),Object(d.a)(Te,"DATA_VALUES",[na]),Te),ua={yyyymmdd:{day:"numeric",month:"short",year:"numeric"},yyyymm:{month:"short",year:"numeric"}},ba=p.a.t("Week");function Ea(e,a){var t=e.year,n=e.month,r=e.week,l=e.day;switch(a){case"YEAR":return t;case"MONTH":return va(t,n);case"WEEK":return"".concat(ba," ").concat(r," / ").concat(t);case"DAY":default:return va(t,n,l)}}function va(e,a,t){return da(t?new Date(e,a-1,t):new Date(e,a-1),t?ua.yyyymmdd:ua.yyyymm)}function da(e,a){var t=V.getState().locale||"en";return new Intl.DateTimeFormat(t,a).format(e)}var Oa=["#7cb5ec","#CC6600","#CCCC00","#66CC00","#ff0066","#000000","#00CCCC"],ha={animation:{duration:180},legend:{position:"bottom"},responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"nearest"},scales:{xAxes:[{display:!0,scaleLabel:{display:!0},ticks:{maxRotation:45,minRotation:45}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:p.a.t("Values")},ticks:{suggestedMin:0,precision:0}}]}},pa={backgroundColor:"rgba(0, 0, 0, 0)",fill:!1,lineTension:0};function Aa(e,a){for(var t=e.aggregationLevel,n=e.category,r=e.chartType,l=e.interval,c=[],s=[],o=A[n].label,i=A[n].subtitle,u=1,b=null,E="FAVORITE_VIEWS"===n?ia[n][t][r]:ia[n],v=a.length,d=E.length,h=0;h<v;h++){var p=a[h];c.push(Ea(p,l));for(var g=0;g<d;g++){var y=E[g];0===h&&s.push(Object(O.a)({},pa,{label:y.label,data:[],borderColor:Oa[g]}));var m=p[y.key];m>u&&(u=m),(null===b||m<b)&&(b=m),s[g].data.push(m)}}return ha.scales.yAxes[0].ticks.suggestedMax=u,ha.scales.yAxes[0].ticks.suggestedMin=b,ha.onResize=ga,{data:{labels:c,datasets:s},options:ha,title:o,subtitle:i}}function ga(e){e.resize()}t(349);var ya=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="TOP_FAVORITES"===t.category||"ERROR"===a,r="LOADING"===a;return{shouldHide:n,loading:r,chartConfig:n||r?null:Aa(t,a)}}))((function(e){var a,t=e.shouldHide,l=e.loading,c=e.chartConfig;if(t)return null;if(l)a=r.a.createElement(L.a,{overlay:!0});else{var s=c.options,o=c.data,i=c.title,u=c.subtitle;a=r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"uaa-chart-title"},i),r.a.createElement("h6",{className:"uaa-chart-subtitle"},u),r.a.createElement("div",{className:"uaa-chart-wrap"},r.a.createElement(Se.a,{data:o,options:s})))}var b=l?"uua-data-container uua-chart-container uua-data-container--loading":"uua-data-container uua-chart-container";return r.a.createElement("div",{className:b},a)})),ma=(t(350),function(e){var a=e.headers;return r.a.createElement("thead",null,r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("th",{key:"h-".concat(a)},e)}))))}),fa=function(e){var a=e.rows;return r.a.createElement("tbody",null,a.map((function(e,a){return r.a.createElement(Da,{key:"row-".concat(a),cells:e})})))},Da=function(e){var a=e.cells;return r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("td",{key:"cell-".concat(a)},e)})))};function Ta(e,a){var t=e.aggregationLevel,n=e.category,r=e.interval,l="FAVORITE_VIEWS"===n?oa[n][t]:oa[n];return{headers:l.map((function(e){return e.label})),rows:a.map((function(e){return l.map((function(a){return a.key===je.key?Ea(e,r):a.key===ta.key?(t=e[a.key],da(new Date(t),ua.yyyymmdd)):e[a.key];var t}))}))}}var Ra=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="ERROR"===a,r="LOADING"===a;return{error:n,loading:r,tableData:r||n?null:Ta(t,a)}}))((function(e){var a,t=e.error,n=e.loading,l=e.tableData;if(t)a=r.a.createElement(J,{message:p.a.t("There was an error retrieving the usage analytics data")});else if(n)a=r.a.createElement(L.a,{overlay:!0});else{var c=l.headers,s=l.rows;a=r.a.createElement("table",{className:"uaa-data-table"},r.a.createElement(ma,{headers:c}),r.a.createElement(fa,{rows:s}))}var o=n?"uua-data-container uua-data-container--loading":"uua-data-container";return r.a.createElement("div",{className:o},a)})),Sa=function(e){function a(){return Object(_.a)(this,a),Object(k.a)(this,Object(I.a)(a).apply(this,arguments))}return Object(w.a)(a,e),Object(C.a)(a,[{key:"componentDidMount",value:function(){this.props.initApp()}},{key:"render",value:function(){var e=this.props.appStatus;return"LOADING"===e?r.a.createElement(F.a,null,r.a.createElement(L.a,{large:!0})):"ERROR"===e?r.a.createElement(J,{message:p.a.t("Error loading application.")}):r.a.createElement("main",{className:"uaa-container"},r.a.createElement(Re,null),r.a.createElement("section",{className:"uaa-content"},r.a.createElement(ya,null),r.a.createElement(Ra,null)))}}]),a}(n.Component),ja=Object(l.b)((function(e){return{appStatus:e.appStatus}}),{initApp:function(){return function(e,a){var t;return U.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,U.a.awrap(G(a().filter));case 3:t=n.sent,e(B("APP_LOAD_SUCCESS",t)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e(B("APP_LOAD_ERROR",n.t0));case 10:case"end":return n.stop()}}),null,null,[[0,7]])}}})(Sa);t(351);a.default=function(){return r.a.createElement(l.a,{store:V},r.a.createElement(ja,null))}}}]);
//# sourceMappingURL=app.8b9de2f1.chunk.js.map