(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{222:function(e,a,t){},224:function(e,a,t){},225:function(e,a,t){},319:function(e,a,t){},320:function(e,a,t){},321:function(e,a,t){},322:function(e,a,t){"use strict";t.r(a);var n=t(1),r=t.n(n),l=t(178),c=t(16),s=t(197),o=t(220);t(221);var i,u,b,E,v,d,O=t(15),g=t(181),p=t(7),h=t.n(p),A=(i={},Object(O.a)(i,"FAVORITE_VIEWS",{value:"FAVORITE_VIEWS",label:h.a.t("Favorite views"),subtitle:h.a.t("Number of times users looked at analysis favorites")}),Object(O.a)(i,"FAVORITES_SAVED",{value:"FAVORITES_SAVED",label:h.a.t("Favorites saved"),subtitle:h.a.t("Number of analysis favorites created by users")}),Object(O.a)(i,"USERS",{value:"USERS",label:h.a.t("Users"),subtitle:h.a.t("Number of users in the system")}),Object(O.a)(i,"TOP_FAVORITES",{value:"TOP_FAVORITES",label:h.a.t("Top favorites")}),Object(O.a)(i,"DATA_VALUES",{value:"DATA_VALUES",label:h.a.t("Data values"),subtitle:h.a.t("Number of data values saved in the system")}),i),y=(u={},Object(O.a)(u,"DAY",{value:"DAY",label:h.a.t("Day")}),Object(O.a)(u,"WEEK",{value:"WEEK",label:h.a.t("Week")}),Object(O.a)(u,"MONTH",{value:"MONTH",label:h.a.t("Month")}),Object(O.a)(u,"YEAR",{value:"YEAR",label:h.a.t("Year")}),u),m=(b={},Object(O.a)(b,"SUM",{value:"SUM",label:h.a.t("Sum")}),Object(O.a)(b,"AVERAGE",{value:"AVERAGE",label:h.a.t("Average")}),b),f=(E={},Object(O.a)(E,"ALL",{value:"ALL",label:h.a.t("All")}),Object(O.a)(E,"TOTAL",{value:"TOTAL",label:h.a.t("Total")}),E),D=(v={},Object(O.a)(v,"CHART_VIEW",{value:"CHART_VIEW",label:h.a.t("Chart")}),Object(O.a)(v,"MAP_VIEW",{value:"MAP_VIEW",label:h.a.t("Map")}),Object(O.a)(v,"REPORT_TABLE_VIEW",{value:"REPORT_TABLE_VIEW",label:h.a.t("Report table")}),Object(O.a)(v,"EVENT_REPORT_VIEW",{value:"EVENT_REPORT_VIEW",label:h.a.t("Event report")}),Object(O.a)(v,"EVENT_CHART_VIEW",{value:"EVENT_CHART_VIEW",label:h.a.t("Event chart")}),Object(O.a)(v,"DASHBOARD_VIEW",{value:"DASHBOARD_VIEW",label:h.a.t("Dashboard")}),Object(O.a)(v,"DATA_SET_REPORT_VIEW",{value:"DATA_SET_REPORT_VIEW",label:h.a.t("Data set report")}),v),T=(d={},Object(O.a)(d,"ASC",{value:"ASC",label:h.a.t("Ascending")}),Object(O.a)(d,"DESC",{value:"DESC",label:h.a.t("Descending")}),d);function R(e){var a=new Date(e.valueOf());return a.setMonth(a.getMonth()-4),{category:"FAVORITE_VIEWS",startDate:S(a),endDate:S(e),interval:"WEEK",aggregationLevel:"SUM",chartType:"ALL",eventType:"CHART_VIEW",pageSize:"25",sortOrder:"ASC"}}function S(e){var a=e.getFullYear(),t=""+(e.getMonth()+1),n=""+e.getDate();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}var j=[o.a];var V=Object(s.c)({appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type;switch(t){case"APP_LOAD_SUCCESS":return"READY";case"APP_LOAD_ERROR":return"ERROR";default:return e}},usageData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"USAGE_DATA_REQUESTED":return"LOADING";case"APP_LOAD_SUCCESS":case"USAGE_DATA_RECEIVED":return n;case"USAGE_DATA_ERRORED":return"ERROR";default:return e}},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(new Date),a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"FILTER_UPDATED":return Object(g.a)({},e,Object(O.a)({},n.key,n.value));default:return e}}}),_=Object(s.d)(V,s.a.apply(void 0,j)),C={method:"GET",credentials:"include"};function k(e,a){return function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C;return e?a?fetch("".concat(e,"/api/").concat(a),t).then((function(e){if(e.ok)return e;throw new Error(e.statusText)})):Promise.reject(new Error("A path must be passed")):Promise.reject(new Error("A baseUrl must be passed"))}(e,a).then((function(e){return e.json()})).then((function(e){if("ERROR"===e.status)throw new Error(e.message);return e}))}var I=function(){var e=null,a=function(a){var t=a.eventType,n=a.pageSize,r=a.sortOrder,l="eventType=".concat(t,"&pageSize=").concat(n,"&sortOrder=").concat(r,"&_=").concat(Date.now());return k(e,"dataStatistics/favorites?".concat(l))},t=function(a){var t=a.startDate,n=a.endDate,r=a.interval,l="startDate=".concat(t,"&endDate=").concat(n,"&interval=").concat(r,"&_=").concat(Date.now());return k(e,"dataStatistics?".concat(l))};return{setBaseUrl:function(a){e=a},getFavorites:a,getDataStatistics:t,getUsageData:function(e){return"TOP_FAVORITES"===e.category?a({eventType:e.eventType,pageSize:e.pageSize,sortOrder:e.sortOrder}):t({startDate:e.startDate,endDate:e.endDate,interval:e.interval})}}}(),w=t(8),F=t(10),P=t(12),U=t(9),L=t(11),N=t(5),W=t(17),M=t.n(W),G=function(e){return function(a,t){var n=t().filter,r=n.category;if(a(H("category",e)),function(e,a){return e!==a&&("TOP_FAVORITES"===a&&"TOP_FAVORITES"!==e||"TOP_FAVORITES"===e&&"TOP_FAVORITES"!==a)}(r,e))return z(Object(g.a)({},n,{category:e}),a)}},x=function(e,a){return function(t,n){return t(H(e,a)),z(n().filter,t)}},H=function(e,a){return Y("FILTER_UPDATED",{key:e,value:a})};function z(e,a){var t;return M.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a(Y("USAGE_DATA_REQUESTED")),n.prev=1,n.next=4,M.a.awrap(I.getUsageData(e));case 4:t=n.sent,a(Y("USAGE_DATA_RECEIVED",t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),a(Y("USAGE_DATA_ERRORED",n.t0));case 11:case"end":return n.stop()}}),null,null,[[1,8]])}function Y(e,a){return{type:e,payload:a}}t(222);var B,K=function(e){var a=e.message;return r.a.createElement("div",{className:"uaa-error"},a)},J=t(214),Q=(B={},Object(O.a)(B,"5",{value:"5",label:"5"}),Object(O.a)(B,"10",{value:"10",label:"10"}),Object(O.a)(B,"15",{value:"15",label:"15"}),Object(O.a)(B,"20",{value:"20",label:"20"}),Object(O.a)(B,"25",{value:"25",label:"25"}),B),q=function(e){var a=e.options,t=e.value,n=Object(J.a)(e,["options","value"]);return r.a.createElement(N.p,Object.assign({},n,{selected:a[t]}),Object.keys(a).map((function(e){return r.a.createElement(N.q,{label:a[e].label,key:a[e].value,value:a[e].value})})))},X=t(3),Z=t(223),$=t.n(Z),ee=(t(224),h.a.t("Please use the format yyyy-mm-dd")),ae=h.a.t("Please fill in both dates"),te=h.a.t("End date is before start date"),ne=h.a.t("Start date is after end date"),re=function(e){function a(e){var t;return Object(w.a)(this,a),(t=Object(P.a)(this,Object(U.a)(a).call(this,e))).state={startDateError:null,endDateError:null},t.onStartDateChange=t.onStartDateChange.bind(Object(X.a)(t)),t.onEndDateChange=t.onEndDateChange.bind(Object(X.a)(t)),t.updateUsageData=$()(e.updateUsageData,250),t}return Object(L.a)(a,e),Object(F.a)(a,[{key:"onStartDateChange",value:function(e){var a=e.value;this.onChange("startDate",a)}},{key:"onEndDateChange",value:function(e){var a=e.value;this.onChange("endDate",a)}},{key:"onChange",value:function(e,a){var t,n=this.props,r=n.updateFilter,l=Object(J.a)(n,["updateFilter"]),c="".concat(e,"Error"),s="".concat("startDate"===e?"endDate":"startDate","Error"),o=this.getError(Object(g.a)({},l,Object(O.a)({},e,a)),e),i=this.state[s]===ee?ee:null;this.state[c]!==o&&this.setState((t={},Object(O.a)(t,c,o),Object(O.a)(t,s,i),t));r(e,a),o||this.updateUsageData()}},{key:"getError",value:function(e,a){return/[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(e[a])?e.startDate&&e.endDate?e.endDate<e.startDate?"startDate"===a?ne:te:null:ae:ee}},{key:"render",value:function(){var e=this.props,a=e.startDate,t=e.endDate,n=this.state,l=n.startDateError,c=n.endDateError;return r.a.createElement("div",{className:"uaa-date-range"},r.a.createElement(N.g,{label:h.a.t("Start Date"),type:"date",value:a,onChange:this.onStartDateChange,error:!!l,validationText:l,name:"startDate",className:"startDate",dataTest:"uaa-startdate"}),r.a.createElement(N.g,{label:h.a.t("End Date"),type:"date",value:t,onChange:this.onEndDateChange,error:!!c,validationText:c,name:"endDate",className:"endDate",dataTest:"uaa-enddate"}))}}]),a}(n.Component),le=Object(l.b)(ve("category"),{onChange:function(e){var a=e.selected.value;return G(a)}})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Category"),options:A}))})),ce=Object(l.b)((function(e){return{startDate:e.filter.startDate,endDate:e.filter.endDate}}),{updateFilter:H,updateUsageData:function(){return function(e,a){return z(a().filter,e)}}})(re),se=Object(l.b)(ve("interval"),{onChange:de(x,"interval")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Interval"),options:y}))})),oe=Object(l.b)(ve("aggregationLevel"),{onChange:de(H,"aggregationLevel")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Aggregation Level"),options:m}))})),ie=Object(l.b)(ve("chartType"),{onChange:de(H,"chartType")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Chart Type"),options:f}))})),ue=Object(l.b)(ve("eventType"),{onChange:de(x,"eventType")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Event Type"),options:D}))})),be=Object(l.b)(ve("pageSize"),{onChange:de(x,"pageSize")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Page Size"),options:Q}))})),Ee=Object(l.b)(ve("sortOrder"),{onChange:de(x,"sortOrder")})((function(e){return r.a.createElement(q,Object.assign({},e,{label:h.a.t("Sort Order"),options:T}))}));function ve(e){return function(a){return{label:e,value:a.filter[e]}}}function de(e,a){return function(t){var n=t.selected.value;return e(a,n)}}t(225);var Oe,ge,pe,he,Ae,ye,me=Object(l.b)((function(e){var a=e.filter.category;return{showDateFields:"TOP_FAVORITES"!==a,showTopFavoritesFields:"TOP_FAVORITES"===a,showFavoriteViewsFields:"FAVORITE_VIEWS"===a}}))((function(e){var a=e.showDateFields,t=e.showFavoriteViewsFields,l=e.showTopFavoritesFields;return r.a.createElement("aside",{className:"uaa-filter-sidebar"},r.a.createElement("h1",{className:"uaa-app-header"},h.a.t("Usage Analytics")),r.a.createElement(le,null),a&&r.a.createElement(n.Fragment,null,r.a.createElement(ce,null),r.a.createElement(se,null)),t&&r.a.createElement(n.Fragment,null,r.a.createElement(oe,null),r.a.createElement(ie,null)),l&&r.a.createElement(n.Fragment,null,r.a.createElement(ue,null),r.a.createElement(be,null),r.a.createElement(Ee,null)))})),fe=t(226),De={key:"date",label:h.a.t("Date")},Te={key:"mapViews",label:h.a.t("Map")},Re={key:"chartViews",label:h.a.t("Chart")},Se={key:"pivotTableViews",label:h.a.t("Pivot Table")},je={key:"eventReportViews",label:h.a.t("Event Report")},Ve={key:"eventChartViews",label:h.a.t("Event Chart")},_e={key:"dashboardViews",label:h.a.t("Dashboard")},Ce={key:"dataSetReportViews",label:h.a.t("Data Set Report")},ke={key:"totalViews",label:h.a.t("Total")},Ie={key:"averageMapViews",label:h.a.t("Average Map")},we={key:"averageChartViews",label:h.a.t("Average Chart")},Fe={key:"averagePivotTableViews",label:h.a.t("Average Pivot Table")},Pe={key:"averageEventReportViews",label:h.a.t("Average Event Report")},Ue={key:"averageEventChartViews",label:h.a.t("Average Event Chart")},Le={key:"averageDashboardViews",label:h.a.t("Average Dashboard")},Ne={key:"averageViews",label:h.a.t("Average")},We={key:"savedMaps",label:h.a.t("Maps")},Me={key:"savedCharts",label:h.a.t("Charts")},Ge={key:"savedPivotTables",label:h.a.t("Pivot Tables")},xe={key:"savedEventReports",label:h.a.t("Event Reports")},He={key:"savedEventCharts",label:h.a.t("Event Charts")},ze={key:"savedDashboards",label:h.a.t("Dashboards")},Ye={key:"savedIndicators",label:h.a.t("Indicators")},Be={key:"activeUsers",label:h.a.t("Active Users")},Ke={key:"users",label:h.a.t("Total Users")},Je={key:"position",label:h.a.t("Position")},Qe={key:"name",label:h.a.t("Name")},qe={key:"views",label:h.a.t("Views")},Xe={key:"id",label:h.a.t("ID")},Ze={key:"created",label:h.a.t("Created")},$e={key:"savedDataValues",label:h.a.t("Data Values")},ea=[Te,Re,Se,je,Ve,_e,Ce],aa=[Ie,we,Fe,Pe,Ue,Le],ta=[We,Me,Ge,xe,He,ze,Ye],na=[Be,Ke],ra=(ge={},Object(O.a)(ge,"FAVORITE_VIEWS",(Oe={},Object(O.a)(Oe,"SUM",[De].concat(ea,[ke])),Object(O.a)(Oe,"AVERAGE",[De].concat(aa,[Ne])),Oe)),Object(O.a)(ge,"FAVORITES_SAVED",[De].concat(ta)),Object(O.a)(ge,"USERS",[De].concat(na)),Object(O.a)(ge,"TOP_FAVORITES",[Je,Qe,qe,Xe,Ze]),Object(O.a)(ge,"DATA_VALUES",[De,$e]),ge),la=(ye={},Object(O.a)(ye,"FAVORITE_VIEWS",(Ae={},Object(O.a)(Ae,"SUM",(pe={},Object(O.a)(pe,"ALL",ea),Object(O.a)(pe,"TOTAL",[ke]),pe)),Object(O.a)(Ae,"AVERAGE",(he={},Object(O.a)(he,"ALL",aa),Object(O.a)(he,"TOTAL",[Ne]),he)),Ae)),Object(O.a)(ye,"FAVORITES_SAVED",ta),Object(O.a)(ye,"USERS",na),Object(O.a)(ye,"DATA_VALUES",[$e]),ye),ca={yyyymmdd:{day:"numeric",month:"short",year:"numeric"},yyyymm:{month:"short",year:"numeric"}},sa=h.a.t("Week");function oa(e,a){var t=e.year,n=e.month,r=e.week,l=e.day;switch(a){case"YEAR":return t;case"MONTH":return ia(t,n);case"WEEK":return"".concat(sa," ").concat(r," / ").concat(t);case"DAY":default:return ia(t,n,l)}}function ia(e,a,t){return ua(t?new Date(e,a-1,t):new Date(e,a-1),t?ca.yyyymmdd:ca.yyyymm)}function ua(e,a){var t=_.getState().locale||"en";return new Intl.DateTimeFormat(t,a).format(e)}var ba=["#7cb5ec","#CC6600","#CCCC00","#66CC00","#ff0066","#000000","#00CCCC"],Ea={animation:{duration:180},legend:{position:"bottom"},responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"nearest"},scales:{xAxes:[{display:!0,scaleLabel:{display:!0},ticks:{maxRotation:45,minRotation:45}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:h.a.t("Values")},ticks:{suggestedMin:0,precision:0}}]}},va={backgroundColor:"rgba(0, 0, 0, 0)",fill:!1,lineTension:0};function da(e,a){for(var t=e.aggregationLevel,n=e.category,r=e.chartType,l=e.interval,c=[],s=[],o=A[n].label,i=A[n].subtitle,u=1,b=null,E="FAVORITE_VIEWS"===n?la[n][t][r]:la[n],v=a.length,d=E.length,O=0;O<v;O++){var p=a[O];c.push(oa(p,l));for(var h=0;h<d;h++){var y=E[h];0===O&&s.push(Object(g.a)({},va,{label:y.label,data:[],borderColor:ba[h]}));var m=p[y.key];m>u&&(u=m),(null===b||m<b)&&(b=m),s[h].data.push(m)}}return Ea.scales.yAxes[0].ticks.suggestedMax=u,Ea.scales.yAxes[0].ticks.suggestedMin=b,Ea.onResize=Oa,{data:{labels:c,datasets:s},options:Ea,title:o,subtitle:i}}function Oa(e){e.resize()}t(319);var ga=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="TOP_FAVORITES"===t.category||"ERROR"===a,r="LOADING"===a;return{shouldHide:n,loading:r,chartConfig:n||r?null:da(t,a)}}))((function(e){var a,t=e.shouldHide,l=e.loading,c=e.chartConfig;if(t)return null;if(l)a=r.a.createElement(N.d,{overlay:!0});else{var s=c.options,o=c.data,i=c.title,u=c.subtitle;a=r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"uaa-chart-title"},i),r.a.createElement("h6",{className:"uaa-chart-subtitle"},u),r.a.createElement("div",{className:"uaa-chart-wrap"},r.a.createElement(fe.a,{data:o,options:s})))}var b=l?"uua-data-container uua-chart-container uua-data-container--loading":"uua-data-container uua-chart-container";return r.a.createElement("div",{className:b},a)})),pa=(t(320),function(e){var a=e.headers;return r.a.createElement("thead",null,r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("th",{key:"h-".concat(a)},e)}))))}),ha=function(e){var a=e.rows;return r.a.createElement("tbody",null,a.map((function(e,a){return r.a.createElement(Aa,{key:"row-".concat(a),cells:e})})))},Aa=function(e){var a=e.cells;return r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("td",{key:"cell-".concat(a)},e)})))};function ya(e,a){var t=e.aggregationLevel,n=e.category,r=e.interval,l="FAVORITE_VIEWS"===n?ra[n][t]:ra[n];return{headers:l.map((function(e){return e.label})),rows:a.map((function(e){return l.map((function(a){return a.key===De.key?oa(e,r):a.key===Ze.key?(t=e[a.key],ua(new Date(t),ca.yyyymmdd)):e[a.key];var t}))}))}}var ma=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="ERROR"===a,r="LOADING"===a;return{error:n,loading:r,tableData:r||n?null:ya(t,a)}}))((function(e){var a,t=e.error,n=e.loading,l=e.tableData;if(t)a=r.a.createElement(K,{message:h.a.t("There was an error retrieving the usage analytics data")});else if(n)a=r.a.createElement(N.d,{overlay:!0});else{var c=l.headers,s=l.rows;a=r.a.createElement("table",{className:"uaa-data-table"},r.a.createElement(pa,{headers:c}),r.a.createElement(ha,{rows:s}))}var o=n?"uua-data-container uua-data-container--loading":"uua-data-container";return r.a.createElement("div",{className:o},a)})),fa=function(e){function a(){return Object(w.a)(this,a),Object(P.a)(this,Object(U.a)(a).apply(this,arguments))}return Object(L.a)(a,e),Object(F.a)(a,[{key:"componentDidMount",value:function(){this.props.initApp()}},{key:"render",value:function(){var e=this.props.appStatus;return"LOADING"===e?r.a.createElement(N.o,null,r.a.createElement(N.d,{large:!0})):"ERROR"===e?r.a.createElement(K,{message:h.a.t("Error loading application.")}):r.a.createElement("main",{className:"uaa-container"},r.a.createElement(me,null),r.a.createElement("section",{className:"uaa-content"},r.a.createElement(ga,null),r.a.createElement(ma,null)))}}]),a}(n.Component),Da=Object(l.b)((function(e){return{appStatus:e.appStatus}}),{initApp:function(){return function(e,a){var t;return M.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,M.a.awrap(I.getUsageData(a().filter));case 3:t=n.sent,e(Y("APP_LOAD_SUCCESS",t)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e(Y("APP_LOAD_ERROR",n.t0));case 10:case"end":return n.stop()}}),null,null,[[0,7]])}}})(fa);t(321);a.default=function(){var e=Object(c.b)().baseUrl;return I.setBaseUrl(e),r.a.createElement(l.a,{store:_},r.a.createElement(Da,null))}}}]);
//# sourceMappingURL=app.7d4f2d41.chunk.js.map