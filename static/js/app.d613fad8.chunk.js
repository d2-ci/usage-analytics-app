(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{223:function(e,a,t){},225:function(e,a,t){},226:function(e,a,t){},320:function(e,a,t){},321:function(e,a,t){},322:function(e,a,t){},323:function(e,a,t){"use strict";t.r(a);var n=t(1),r=t.n(n),l=t(179),s=t(16),c=t(198),o=t(221);t(222);var i=t(15),u=t(182),v=t(6),b=t.n(v),E=[{value:"FAVORITE_VIEWS",label:b.a.t("Favorite views"),subtitle:b.a.t("Number of times users looked at analysis favorites")},{value:"FAVORITES_SAVED",label:b.a.t("Favorites saved"),subtitle:b.a.t("Number of analysis favorites created by users")},{value:"USERS",label:b.a.t("Users"),subtitle:b.a.t("Number of users in the system")},{value:"TOP_FAVORITES",label:b.a.t("Top favorites")},{value:"DATA_VALUES",label:b.a.t("Data values"),subtitle:b.a.t("Number of data values saved in the system")}],d=[{value:"DAY",label:b.a.t("Day")},{value:"WEEK",label:b.a.t("Week")},{value:"MONTH",label:b.a.t("Month")},{value:"YEAR",label:b.a.t("Year")}],g=[{value:"SUM",label:b.a.t("Sum")},{value:"AVERAGE",label:b.a.t("Average")}],p=[{value:"ALL",label:b.a.t("All")},{value:"TOTAL",label:b.a.t("Total")}],h=[{value:"CHART_VIEW",label:b.a.t("Chart")},{value:"MAP_VIEW",label:b.a.t("Map")},{value:"REPORT_TABLE_VIEW",label:b.a.t("Report table")},{value:"EVENT_REPORT_VIEW",label:b.a.t("Event report")},{value:"EVENT_CHART_VIEW",label:b.a.t("Event chart")},{value:"DASHBOARD_VIEW",label:b.a.t("Dashboard")},{value:"DATA_SET_REPORT_VIEW",label:b.a.t("Data set report")}],f=[{value:"ASC",label:b.a.t("Ascending")},{value:"DESC",label:b.a.t("Descending")}];function m(e){var a=new Date(e.valueOf());return a.setMonth(a.getMonth()-4),{category:"FAVORITE_VIEWS",startDate:y(a),endDate:y(e),interval:"WEEK",aggregationLevel:"SUM",chartType:"ALL",eventType:"CHART_VIEW",pageSize:"25",sortOrder:"ASC"}}function y(e){var a=e.getFullYear(),t=""+(e.getMonth()+1),n=""+e.getDate();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}var O=[o.a];var D=Object(c.c)({appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type;switch(t){case"APP_LOAD_SUCCESS":return"READY";case"APP_LOAD_ERROR":return"ERROR";default:return e}},usageData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"USAGE_DATA_REQUESTED":return"LOADING";case"APP_LOAD_SUCCESS":case"USAGE_DATA_RECEIVED":return n;case"USAGE_DATA_ERRORED":return"ERROR";default:return e}},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m(new Date),a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"FILTER_UPDATED":return Object(u.a)({},e,Object(i.a)({},n.key,n.value));default:return e}}}),A=Object(c.d)(D,c.a.apply(void 0,O)),T={method:"GET",credentials:"include"};function R(e,a){return function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T;return e?a?fetch("".concat(e,"/api/").concat(a),t).then((function(e){if(e.ok)return e;throw new Error(e.statusText)})):Promise.reject(new Error("A path must be passed")):Promise.reject(new Error("A baseUrl must be passed"))}(e,a).then((function(e){return e.json()})).then((function(e){if("ERROR"===e.status)throw new Error(e.message);return e}))}var S=function(){var e=null,a=function(a){var t=a.eventType,n=a.pageSize,r=a.sortOrder,l="eventType=".concat(t,"&pageSize=").concat(n,"&sortOrder=").concat(r,"&_=").concat(Date.now());return R(e,"dataStatistics/favorites?".concat(l))},t=function(a){var t=a.startDate,n=a.endDate,r=a.interval,l="startDate=".concat(t,"&endDate=").concat(n,"&interval=").concat(r,"&_=").concat(Date.now());return R(e,"dataStatistics?".concat(l))};return{setBaseUrl:function(a){e=a},getFavorites:a,getDataStatistics:t,getUsageData:function(e){return"TOP_FAVORITES"===e.category?a({eventType:e.eventType,pageSize:e.pageSize,sortOrder:e.sortOrder}):t({startDate:e.startDate,endDate:e.endDate,interval:e.interval})}}}(),V=t(8),C=t(11),j=t(13),k=t(10),_=t(12),w=t(14),I=t(17),F=t.n(I),U=function(e){return function(a,t){var n=t().filter,r=n.category;if(a(L("category",e)),function(e,a){return e!==a&&("TOP_FAVORITES"===a&&"TOP_FAVORITES"!==e||"TOP_FAVORITES"===e&&"TOP_FAVORITES"!==a)}(r,e))return N(Object(u.a)({},n,{category:e}),a)}},P=function(e,a){return function(t,n){return t(L(e,a)),N(n().filter,t)}},L=function(e,a){return M("FILTER_UPDATED",{key:e,value:a})};function N(e,a){var t;return F.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a(M("USAGE_DATA_REQUESTED")),n.prev=1,n.next=4,F.a.awrap(S.getUsageData(e));case 4:t=n.sent,a(M("USAGE_DATA_RECEIVED",t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),a(M("USAGE_DATA_ERRORED",n.t0));case 11:case"end":return n.stop()}}),null,null,[[1,8]])}function M(e,a){return{type:e,payload:a}}t(223);var W=function(e){var a=e.message;return r.a.createElement("div",{className:"uaa-error"},a)},x=t(215),G=[{value:"5",label:"5"},{value:"10",label:"10"},{value:"15",label:"15"},{value:"20",label:"20"},{value:"25",label:"25"}],z=function(e){var a=e.options,t=e.value,n=Object(x.a)(e,["options","value"]);return r.a.createElement(w.l,Object.assign({},n,{selected:t}),a.map((function(e){var a=e.label,t=e.value;return r.a.createElement(w.m,{label:a,key:t,value:t})})))},H=t(4),Y=t(224),B=t.n(Y),K=(t(225),b.a.t("Please use the format yyyy-mm-dd")),J=b.a.t("Please fill in both dates"),Q=b.a.t("End date is before start date"),q=b.a.t("Start date is after end date"),X=function(e){function a(e){var t;return Object(V.a)(this,a),(t=Object(j.a)(this,Object(k.a)(a).call(this,e))).state={startDateError:null,endDateError:null},t.onStartDateChange=t.onStartDateChange.bind(Object(H.a)(t)),t.onEndDateChange=t.onEndDateChange.bind(Object(H.a)(t)),t.updateUsageData=B()(e.updateUsageData,250),t}return Object(_.a)(a,e),Object(C.a)(a,[{key:"onStartDateChange",value:function(e){var a=e.value;this.onChange("startDate",a)}},{key:"onEndDateChange",value:function(e){var a=e.value;this.onChange("endDate",a)}},{key:"onChange",value:function(e,a){var t,n=this.props,r=n.updateFilter,l=Object(x.a)(n,["updateFilter"]),s="".concat(e,"Error"),c="".concat("startDate"===e?"endDate":"startDate","Error"),o=this.getError(Object(u.a)({},l,Object(i.a)({},e,a)),e),v=this.state[c]===K?K:null;this.state[s]!==o&&this.setState((t={},Object(i.a)(t,s,o),Object(i.a)(t,c,v),t));r(e,a),o||this.updateUsageData()}},{key:"getError",value:function(e,a){return/[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(e[a])?e.startDate&&e.endDate?e.endDate<e.startDate?"startDate"===a?q:Q:null:J:K}},{key:"render",value:function(){var e=this.props,a=e.startDate,t=e.endDate,n=this.state,l=n.startDateError,s=n.endDateError;return r.a.createElement("div",{className:"uaa-date-range"},r.a.createElement(w.f,{label:b.a.t("Start Date"),type:"date",value:a,onChange:this.onStartDateChange,error:!!l,validationText:l,name:"startDate",className:"startDate",dataTest:"uaa-startdate"}),r.a.createElement(w.f,{label:b.a.t("End Date"),type:"date",value:t,onChange:this.onEndDateChange,error:!!s,validationText:s,name:"endDate",className:"endDate",dataTest:"uaa-enddate"}))}}]),a}(n.Component),Z=Object(l.b)(se("category"),{onChange:function(e){var a=e.selected;return U(a)}})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Category"),options:E}))})),$=Object(l.b)((function(e){return{startDate:e.filter.startDate,endDate:e.filter.endDate}}),{updateFilter:L,updateUsageData:function(){return function(e,a){return N(a().filter,e)}}})(X),ee=Object(l.b)(se("interval"),{onChange:ce(P,"interval")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Interval"),options:d}))})),ae=Object(l.b)(se("aggregationLevel"),{onChange:ce(L,"aggregationLevel")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Aggregation Level"),options:g}))})),te=Object(l.b)(se("chartType"),{onChange:ce(L,"chartType")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Chart Type"),options:p}))})),ne=Object(l.b)(se("eventType"),{onChange:ce(P,"eventType")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Event Type"),options:h}))})),re=Object(l.b)(se("pageSize"),{onChange:ce(P,"pageSize")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Page Size"),options:G}))})),le=Object(l.b)(se("sortOrder"),{onChange:ce(P,"sortOrder")})((function(e){return r.a.createElement(z,Object.assign({},e,{label:b.a.t("Sort Order"),options:f}))}));function se(e){return function(a){return{label:e,value:a.filter[e]}}}function ce(e,a){return function(t){var n=t.selected;return e(a,n)}}t(226);var oe,ie,ue,ve,be,Ee,de=Object(l.b)((function(e){var a=e.filter.category;return{showDateFields:"TOP_FAVORITES"!==a,showTopFavoritesFields:"TOP_FAVORITES"===a,showFavoriteViewsFields:"FAVORITE_VIEWS"===a}}))((function(e){var a=e.showDateFields,t=e.showFavoriteViewsFields,l=e.showTopFavoritesFields;return r.a.createElement("aside",{className:"uaa-filter-sidebar"},r.a.createElement("h1",{className:"uaa-app-header"},b.a.t("Usage Analytics")),r.a.createElement(Z,null),a&&r.a.createElement(n.Fragment,null,r.a.createElement($,null),r.a.createElement(ee,null)),t&&r.a.createElement(n.Fragment,null,r.a.createElement(ae,null),r.a.createElement(te,null)),l&&r.a.createElement(n.Fragment,null,r.a.createElement(ne,null),r.a.createElement(re,null),r.a.createElement(le,null)))})),ge=t(227),pe={key:"date",label:b.a.t("Date")},he={key:"mapViews",label:b.a.t("Map")},fe={key:"chartViews",label:b.a.t("Chart")},me={key:"pivotTableViews",label:b.a.t("Pivot Table")},ye={key:"eventReportViews",label:b.a.t("Event Report")},Oe={key:"eventChartViews",label:b.a.t("Event Chart")},De={key:"dashboardViews",label:b.a.t("Dashboard")},Ae={key:"dataSetReportViews",label:b.a.t("Data Set Report")},Te={key:"totalViews",label:b.a.t("Total")},Re={key:"averageMapViews",label:b.a.t("Average Map")},Se={key:"averageChartViews",label:b.a.t("Average Chart")},Ve={key:"averagePivotTableViews",label:b.a.t("Average Pivot Table")},Ce={key:"averageEventReportViews",label:b.a.t("Average Event Report")},je={key:"averageEventChartViews",label:b.a.t("Average Event Chart")},ke={key:"averageDashboardViews",label:b.a.t("Average Dashboard")},_e={key:"averageViews",label:b.a.t("Average")},we={key:"savedMaps",label:b.a.t("Maps")},Ie={key:"savedCharts",label:b.a.t("Charts")},Fe={key:"savedPivotTables",label:b.a.t("Pivot Tables")},Ue={key:"savedEventReports",label:b.a.t("Event Reports")},Pe={key:"savedEventCharts",label:b.a.t("Event Charts")},Le={key:"savedDashboards",label:b.a.t("Dashboards")},Ne={key:"savedIndicators",label:b.a.t("Indicators")},Me={key:"activeUsers",label:b.a.t("Active Users")},We={key:"users",label:b.a.t("Total Users")},xe={key:"position",label:b.a.t("Position")},Ge={key:"name",label:b.a.t("Name")},ze={key:"views",label:b.a.t("Views")},He={key:"id",label:b.a.t("ID")},Ye={key:"created",label:b.a.t("Created")},Be={key:"savedDataValues",label:b.a.t("Data Values")},Ke=[he,fe,me,ye,Oe,De,Ae],Je=[Re,Se,Ve,Ce,je,ke],Qe=[we,Ie,Fe,Ue,Pe,Le,Ne],qe=[Me,We],Xe=(ie={},Object(i.a)(ie,"FAVORITE_VIEWS",(oe={},Object(i.a)(oe,"SUM",[pe].concat(Ke,[Te])),Object(i.a)(oe,"AVERAGE",[pe].concat(Je,[_e])),oe)),Object(i.a)(ie,"FAVORITES_SAVED",[pe].concat(Qe)),Object(i.a)(ie,"USERS",[pe].concat(qe)),Object(i.a)(ie,"TOP_FAVORITES",[xe,Ge,ze,He,Ye]),Object(i.a)(ie,"DATA_VALUES",[pe,Be]),ie),Ze=(Ee={},Object(i.a)(Ee,"FAVORITE_VIEWS",(be={},Object(i.a)(be,"SUM",(ue={},Object(i.a)(ue,"ALL",Ke),Object(i.a)(ue,"TOTAL",[Te]),ue)),Object(i.a)(be,"AVERAGE",(ve={},Object(i.a)(ve,"ALL",Je),Object(i.a)(ve,"TOTAL",[_e]),ve)),be)),Object(i.a)(Ee,"FAVORITES_SAVED",Qe),Object(i.a)(Ee,"USERS",qe),Object(i.a)(Ee,"DATA_VALUES",[Be]),Ee),$e={yyyymmdd:{day:"numeric",month:"short",year:"numeric"},yyyymm:{month:"short",year:"numeric"}},ea=b.a.t("Week");function aa(e,a){var t=e.year,n=e.month,r=e.week,l=e.day;switch(a){case"YEAR":return t;case"MONTH":return ta(t,n);case"WEEK":return"".concat(ea," ").concat(r," / ").concat(t);case"DAY":default:return ta(t,n,l)}}function ta(e,a,t){return na(t?new Date(e,a-1,t):new Date(e,a-1),t?$e.yyyymmdd:$e.yyyymm)}function na(e,a){var t=A.getState().locale||"en";return new Intl.DateTimeFormat(t,a).format(e)}var ra=["#7cb5ec","#CC6600","#CCCC00","#66CC00","#ff0066","#000000","#00CCCC"],la={animation:{duration:180},legend:{position:"bottom"},responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"nearest"},scales:{xAxes:[{display:!0,scaleLabel:{display:!0},ticks:{maxRotation:45,minRotation:45}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:b.a.t("Values")},ticks:{suggestedMin:0,precision:0}}]}},sa={backgroundColor:"rgba(0, 0, 0, 0)",fill:!1,lineTension:0};function ca(e,a){for(var t=e.aggregationLevel,n=e.category,r=e.chartType,l=e.interval,s=[],c=[],o=E.find((function(e){return e.value===n})),i=1,v=null,b="FAVORITE_VIEWS"===n?Ze[n][t][r]:Ze[n],d=a.length,g=b.length,p=0;p<d;p++){var h=a[p];s.push(aa(h,l));for(var f=0;f<g;f++){var m=b[f];0===p&&c.push(Object(u.a)({},sa,{label:m.label,data:[],borderColor:ra[f]}));var y=h[m.key];y>i&&(i=y),(null===v||y<v)&&(v=y),c[f].data.push(y)}}return la.scales.yAxes[0].ticks.suggestedMax=i,la.scales.yAxes[0].ticks.suggestedMin=v,la.onResize=oa,{data:{labels:s,datasets:c},options:la,title:o.label,subtitle:o.subtitle}}function oa(e){e.resize()}t(320);var ia=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="TOP_FAVORITES"===t.category||"ERROR"===a,r="LOADING"===a;return{shouldHide:n,loading:r,chartConfig:n||r?null:ca(t,a)}}))((function(e){var a,t=e.shouldHide,l=e.loading,s=e.chartConfig;if(t)return null;if(l)a=r.a.createElement(w.c,{overlay:!0});else{var c=s.options,o=s.data,i=s.title,u=s.subtitle;a=r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"uaa-chart-title"},i),r.a.createElement("h6",{className:"uaa-chart-subtitle"},u),r.a.createElement("div",{className:"uaa-chart-wrap"},r.a.createElement(ge.a,{data:o,options:c})))}var v=l?"uua-data-container uua-chart-container uua-data-container--loading":"uua-data-container uua-chart-container";return r.a.createElement("div",{className:v},a)})),ua=(t(321),function(e){var a=e.headers;return r.a.createElement("thead",null,r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("th",{key:"h-".concat(a)},e)}))))}),va=function(e){var a=e.rows;return r.a.createElement("tbody",null,a.map((function(e,a){return r.a.createElement(ba,{key:"row-".concat(a),cells:e})})))},ba=function(e){var a=e.cells;return r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("td",{key:"cell-".concat(a)},e)})))};function Ea(e,a){var t=e.aggregationLevel,n=e.category,r=e.interval,l="FAVORITE_VIEWS"===n?Xe[n][t]:Xe[n];return{headers:l.map((function(e){return e.label})),rows:a.map((function(e){return l.map((function(a){return a.key===pe.key?aa(e,r):a.key===Ye.key?(t=e[a.key],na(new Date(t),$e.yyyymmdd)):e[a.key];var t}))}))}}var da=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="ERROR"===a,r="LOADING"===a;return{error:n,loading:r,tableData:r||n?null:Ea(t,a)}}))((function(e){var a,t=e.error,n=e.loading,l=e.tableData;if(t)a=r.a.createElement(W,{message:b.a.t("There was an error retrieving the usage analytics data")});else if(n)a=r.a.createElement(w.c,{overlay:!0});else{var s=l.headers,c=l.rows;a=r.a.createElement("table",{className:"uaa-data-table"},r.a.createElement(ua,{headers:s}),r.a.createElement(va,{rows:c}))}var o=n?"uua-data-container uua-data-container--loading":"uua-data-container";return r.a.createElement("div",{className:o},a)})),ga=function(e){function a(){return Object(V.a)(this,a),Object(j.a)(this,Object(k.a)(a).apply(this,arguments))}return Object(_.a)(a,e),Object(C.a)(a,[{key:"componentDidMount",value:function(){this.props.initApp()}},{key:"render",value:function(){var e=this.props.appStatus;return"LOADING"===e?r.a.createElement(w.g,{translucent:!0},r.a.createElement(w.b,null,r.a.createElement(w.c,{large:!0}))):"ERROR"===e?r.a.createElement(W,{message:b.a.t("Error loading application.")}):r.a.createElement("main",{className:"uaa-container"},r.a.createElement(de,null),r.a.createElement("section",{className:"uaa-content"},r.a.createElement(ia,null),r.a.createElement(da,null)))}}]),a}(n.Component),pa=Object(l.b)((function(e){return{appStatus:e.appStatus}}),{initApp:function(){return function(e,a){var t;return F.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,F.a.awrap(S.getUsageData(a().filter));case 3:t=n.sent,e(M("APP_LOAD_SUCCESS",t)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e(M("APP_LOAD_ERROR",n.t0));case 10:case"end":return n.stop()}}),null,null,[[0,7]])}}})(ga);t(322);a.default=function(){var e=Object(s.b)().baseUrl;return S.setBaseUrl(e),r.a.createElement(l.a,{store:A},r.a.createElement(pa,null))}}}]);
//# sourceMappingURL=app.d613fad8.chunk.js.map