(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{231:function(e,a,t){},233:function(e,a,t){},234:function(e,a,t){},328:function(e,a,t){},329:function(e,a,t){},330:function(e,a,t){},332:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(186),c=t(16),s=t(206),o=t(229);t(230);var i,u,b,E,v,d,O=t(15),g=t(190),p=t(5),h=t.n(p),A=(i={},Object(O.a)(i,"FAVORITE_VIEWS",{value:"FAVORITE_VIEWS",label:h.a.t("Favorite views"),subtitle:h.a.t("Number of times users looked at analysis favorites")}),Object(O.a)(i,"FAVORITES_SAVED",{value:"FAVORITES_SAVED",label:h.a.t("Favorites saved"),subtitle:h.a.t("Number of analysis favorites created by users")}),Object(O.a)(i,"USERS",{value:"USERS",label:h.a.t("Users"),subtitle:h.a.t("Number of users in the system")}),Object(O.a)(i,"TOP_FAVORITES",{value:"TOP_FAVORITES",label:h.a.t("Top favorites")}),Object(O.a)(i,"DATA_VALUES",{value:"DATA_VALUES",label:h.a.t("Data values"),subtitle:h.a.t("Number of data values saved in the system")}),i),y=(u={},Object(O.a)(u,"DAY",{value:"DAY",label:h.a.t("Day")}),Object(O.a)(u,"WEEK",{value:"WEEK",label:h.a.t("Week")}),Object(O.a)(u,"MONTH",{value:"MONTH",label:h.a.t("Month")}),Object(O.a)(u,"YEAR",{value:"YEAR",label:h.a.t("Year")}),u),m=(b={},Object(O.a)(b,"SUM",{value:"SUM",label:h.a.t("Sum")}),Object(O.a)(b,"AVERAGE",{value:"AVERAGE",label:h.a.t("Average")}),b),f=(E={},Object(O.a)(E,"ALL",{value:"ALL",label:h.a.t("All")}),Object(O.a)(E,"TOTAL",{value:"TOTAL",label:h.a.t("Total")}),E),D=(v={},Object(O.a)(v,"CHART_VIEW",{value:"CHART_VIEW",label:h.a.t("Chart")}),Object(O.a)(v,"MAP_VIEW",{value:"MAP_VIEW",label:h.a.t("Map")}),Object(O.a)(v,"REPORT_TABLE_VIEW",{value:"REPORT_TABLE_VIEW",label:h.a.t("Report table")}),Object(O.a)(v,"EVENT_REPORT_VIEW",{value:"EVENT_REPORT_VIEW",label:h.a.t("Event report")}),Object(O.a)(v,"EVENT_CHART_VIEW",{value:"EVENT_CHART_VIEW",label:h.a.t("Event chart")}),Object(O.a)(v,"DASHBOARD_VIEW",{value:"DASHBOARD_VIEW",label:h.a.t("Dashboard")}),Object(O.a)(v,"DATA_SET_REPORT_VIEW",{value:"DATA_SET_REPORT_VIEW",label:h.a.t("Data set report")}),v),T=(d={},Object(O.a)(d,"ASC",{value:"ASC",label:h.a.t("Ascending")}),Object(O.a)(d,"DESC",{value:"DESC",label:h.a.t("Descending")}),d);function R(e){var a=new Date(e.valueOf());return a.setMonth(a.getMonth()-4),{category:"FAVORITE_VIEWS",startDate:S(a),endDate:S(e),interval:"WEEK",aggregationLevel:"SUM",chartType:"ALL",eventType:"CHART_VIEW",pageSize:"25",sortOrder:"ASC"}}function S(e){var a=e.getFullYear(),t=""+(e.getMonth()+1),n=""+e.getDate();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}var j=[o.a];var V=Object(s.c)({appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type;switch(t){case"APP_LOAD_SUCCESS":return"READY";case"APP_LOAD_ERROR":return"ERROR";default:return e}},usageData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"LOADING",a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"USAGE_DATA_REQUESTED":return"LOADING";case"APP_LOAD_SUCCESS":case"USAGE_DATA_RECEIVED":return n;case"USAGE_DATA_ERRORED":return"ERROR";default:return e}},filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(new Date),a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload;switch(t){case"FILTER_UPDATED":return Object(g.a)({},e,Object(O.a)({},n.key,n.value));default:return e}}}),_=Object(s.d)(V,s.a.apply(void 0,j)),C={method:"GET",credentials:"include"};function k(e,a){return function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C;return e?a?fetch("".concat(e,"/api/").concat(a),t).then((function(e){if(e.ok)return e;throw new Error(e.statusText)})):Promise.reject(new Error("A path must be passed")):Promise.reject(new Error("A baseUrl must be passed"))}(e,a).then((function(e){return e.json()})).then((function(e){if("ERROR"===e.status)throw new Error(e.message);return e}))}var I=function(){var e=null,a=function(a){var t=a.eventType,n=a.pageSize,r=a.sortOrder,l="eventType=".concat(t,"&pageSize=").concat(n,"&sortOrder=").concat(r,"&_=").concat(Date.now());return k(e,"dataStatistics/favorites?".concat(l))},t=function(a){var t=a.startDate,n=a.endDate,r=a.interval,l="startDate=".concat(t,"&endDate=").concat(n,"&interval=").concat(r,"&_=").concat(Date.now());return k(e,"dataStatistics?".concat(l))};return{setBaseUrl:function(a){e=a},getFavorites:a,getDataStatistics:t,getUsageData:function(e){return"TOP_FAVORITES"===e.category?a({eventType:e.eventType,pageSize:e.pageSize,sortOrder:e.sortOrder}):t({startDate:e.startDate,endDate:e.endDate,interval:e.interval})}}}(),w=t(9),F=t(11),P=t(14),U=t(10),L=t(13),N=t(32),W=t(179),M=t(17),G=t.n(M),x=function(e){return function(a,t){var n=t().filter,r=n.category;if(a(z("category",e)),function(e,a){return e!==a&&("TOP_FAVORITES"===a&&"TOP_FAVORITES"!==e||"TOP_FAVORITES"===e&&"TOP_FAVORITES"!==a)}(r,e))return Y(Object(g.a)({},n,{category:e}),a)}},H=function(e,a){return function(t,n){return t(z(e,a)),Y(n().filter,t)}},z=function(e,a){return B("FILTER_UPDATED",{key:e,value:a})};function Y(e,a){var t;return G.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a(B("USAGE_DATA_REQUESTED")),n.prev=1,n.next=4,G.a.awrap(I.getUsageData(e));case 4:t=n.sent,a(B("USAGE_DATA_RECEIVED",t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),a(B("USAGE_DATA_ERRORED",n.t0));case 11:case"end":return n.stop()}}),null,null,[[1,8]])}function B(e,a){return{type:e,payload:a}}t(231);var K,J=function(e){var a=e.message;return r.a.createElement("div",{className:"uaa-error"},a)},Q=t(223),q=t(333),X=t(331),Z=(K={},Object(O.a)(K,"5",{value:"5",label:"5"}),Object(O.a)(K,"10",{value:"10",label:"10"}),Object(O.a)(K,"15",{value:"15",label:"15"}),Object(O.a)(K,"20",{value:"20",label:"20"}),Object(O.a)(K,"25",{value:"25",label:"25"}),K),$=function(e){var a=e.options,t=e.value,n=Object(Q.a)(e,["options","value"]);return r.a.createElement(q.a,Object.assign({},n,{selected:a[t]}),Object.keys(a).map((function(e){return r.a.createElement(X.a,{label:a[e].label,key:a[e].value,value:a[e].value})})))},ee=t(8),ae=t(181),te=t(232),ne=t.n(te),re=(t(233),h.a.t("Please use the format yyyy-mm-dd")),le=h.a.t("Please fill in both dates"),ce=h.a.t("End date is before start date"),se=h.a.t("Start date is after end date"),oe=function(e){function a(e){var t;return Object(w.a)(this,a),(t=Object(P.a)(this,Object(U.a)(a).call(this,e))).state={startDateError:null,endDateError:null},t.onStartDateChange=t.onStartDateChange.bind(Object(ee.a)(t)),t.onEndDateChange=t.onEndDateChange.bind(Object(ee.a)(t)),t.updateUsageData=ne()(e.updateUsageData,250),t}return Object(L.a)(a,e),Object(F.a)(a,[{key:"onStartDateChange",value:function(e){var a=e.value;this.onChange("startDate",a)}},{key:"onEndDateChange",value:function(e){var a=e.value;this.onChange("endDate",a)}},{key:"onChange",value:function(e,a){var t,n=this.props,r=n.updateFilter,l=Object(Q.a)(n,["updateFilter"]),c="".concat(e,"Error"),s="".concat("startDate"===e?"endDate":"startDate","Error"),o=this.getError(Object(g.a)({},l,Object(O.a)({},e,a)),e),i=this.state[s]===re?re:null;this.state[c]!==o&&this.setState((t={},Object(O.a)(t,c,o),Object(O.a)(t,s,i),t));r(e,a),o||this.updateUsageData()}},{key:"getError",value:function(e,a){return/[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(e[a])?e.startDate&&e.endDate?e.endDate<e.startDate?"startDate"===a?se:ce:null:le:re}},{key:"render",value:function(){var e=this.props,a=e.startDate,t=e.endDate,n=this.state,l=n.startDateError,c=n.endDateError;return r.a.createElement("div",{className:"uaa-date-range"},r.a.createElement(ae.a,{label:h.a.t("Start Date"),type:"date",value:a,onChange:this.onStartDateChange,error:!!l,validationText:l,name:"startDate",className:"startDate",dataTest:"uaa-startdate"}),r.a.createElement(ae.a,{label:h.a.t("End Date"),type:"date",value:t,onChange:this.onEndDateChange,error:!!c,validationText:c,name:"endDate",className:"endDate",dataTest:"uaa-enddate"}))}}]),a}(n.Component),ie=Object(l.b)(pe("category"),{onChange:function(e){var a=e.selected.value;return x(a)}})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Category"),options:A}))})),ue=Object(l.b)((function(e){return{startDate:e.filter.startDate,endDate:e.filter.endDate}}),{updateFilter:z,updateUsageData:function(){return function(e,a){return Y(a().filter,e)}}})(oe),be=Object(l.b)(pe("interval"),{onChange:he(H,"interval")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Interval"),options:y}))})),Ee=Object(l.b)(pe("aggregationLevel"),{onChange:he(z,"aggregationLevel")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Aggregation Level"),options:m}))})),ve=Object(l.b)(pe("chartType"),{onChange:he(z,"chartType")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Chart Type"),options:f}))})),de=Object(l.b)(pe("eventType"),{onChange:he(H,"eventType")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Event Type"),options:D}))})),Oe=Object(l.b)(pe("pageSize"),{onChange:he(H,"pageSize")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Page Size"),options:Z}))})),ge=Object(l.b)(pe("sortOrder"),{onChange:he(H,"sortOrder")})((function(e){return r.a.createElement($,Object.assign({},e,{label:h.a.t("Sort Order"),options:T}))}));function pe(e){return function(a){return{label:e,value:a.filter[e]}}}function he(e,a){return function(t){var n=t.selected.value;return e(a,n)}}t(234);var Ae,ye,me,fe,De,Te,Re=Object(l.b)((function(e){var a=e.filter.category;return{showDateFields:"TOP_FAVORITES"!==a,showTopFavoritesFields:"TOP_FAVORITES"===a,showFavoriteViewsFields:"FAVORITE_VIEWS"===a}}))((function(e){var a=e.showDateFields,t=e.showFavoriteViewsFields,l=e.showTopFavoritesFields;return r.a.createElement("aside",{className:"uaa-filter-sidebar"},r.a.createElement("h1",{className:"uaa-app-header"},h.a.t("Usage Analytics")),r.a.createElement(ie,null),a&&r.a.createElement(n.Fragment,null,r.a.createElement(ue,null),r.a.createElement(be,null)),t&&r.a.createElement(n.Fragment,null,r.a.createElement(Ee,null),r.a.createElement(ve,null)),l&&r.a.createElement(n.Fragment,null,r.a.createElement(de,null),r.a.createElement(Oe,null),r.a.createElement(ge,null)))})),Se=t(235),je={key:"date",label:h.a.t("Date")},Ve={key:"mapViews",label:h.a.t("Map")},_e={key:"chartViews",label:h.a.t("Chart")},Ce={key:"pivotTableViews",label:h.a.t("Pivot Table")},ke={key:"eventReportViews",label:h.a.t("Event Report")},Ie={key:"eventChartViews",label:h.a.t("Event Chart")},we={key:"dashboardViews",label:h.a.t("Dashboard")},Fe={key:"dataSetReportViews",label:h.a.t("Data Set Report")},Pe={key:"totalViews",label:h.a.t("Total")},Ue={key:"averageMapViews",label:h.a.t("Average Map")},Le={key:"averageChartViews",label:h.a.t("Average Chart")},Ne={key:"averagePivotTableViews",label:h.a.t("Average Pivot Table")},We={key:"averageEventReportViews",label:h.a.t("Average Event Report")},Me={key:"averageEventChartViews",label:h.a.t("Average Event Chart")},Ge={key:"averageDashboardViews",label:h.a.t("Average Dashboard")},xe={key:"averageViews",label:h.a.t("Average")},He={key:"savedMaps",label:h.a.t("Maps")},ze={key:"savedCharts",label:h.a.t("Charts")},Ye={key:"savedPivotTables",label:h.a.t("Pivot Tables")},Be={key:"savedEventReports",label:h.a.t("Event Reports")},Ke={key:"savedEventCharts",label:h.a.t("Event Charts")},Je={key:"savedDashboards",label:h.a.t("Dashboards")},Qe={key:"savedIndicators",label:h.a.t("Indicators")},qe={key:"activeUsers",label:h.a.t("Active Users")},Xe={key:"users",label:h.a.t("Total Users")},Ze={key:"position",label:h.a.t("Position")},$e={key:"name",label:h.a.t("Name")},ea={key:"views",label:h.a.t("Views")},aa={key:"id",label:h.a.t("ID")},ta={key:"created",label:h.a.t("Created")},na={key:"savedDataValues",label:h.a.t("Data Values")},ra=[Ve,_e,Ce,ke,Ie,we,Fe],la=[Ue,Le,Ne,We,Me,Ge],ca=[He,ze,Ye,Be,Ke,Je,Qe],sa=[qe,Xe],oa=(ye={},Object(O.a)(ye,"FAVORITE_VIEWS",(Ae={},Object(O.a)(Ae,"SUM",[je].concat(ra,[Pe])),Object(O.a)(Ae,"AVERAGE",[je].concat(la,[xe])),Ae)),Object(O.a)(ye,"FAVORITES_SAVED",[je].concat(ca)),Object(O.a)(ye,"USERS",[je].concat(sa)),Object(O.a)(ye,"TOP_FAVORITES",[Ze,$e,ea,aa,ta]),Object(O.a)(ye,"DATA_VALUES",[je,na]),ye),ia=(Te={},Object(O.a)(Te,"FAVORITE_VIEWS",(De={},Object(O.a)(De,"SUM",(me={},Object(O.a)(me,"ALL",ra),Object(O.a)(me,"TOTAL",[Pe]),me)),Object(O.a)(De,"AVERAGE",(fe={},Object(O.a)(fe,"ALL",la),Object(O.a)(fe,"TOTAL",[xe]),fe)),De)),Object(O.a)(Te,"FAVORITES_SAVED",ca),Object(O.a)(Te,"USERS",sa),Object(O.a)(Te,"DATA_VALUES",[na]),Te),ua={yyyymmdd:{day:"numeric",month:"short",year:"numeric"},yyyymm:{month:"short",year:"numeric"}},ba=h.a.t("Week");function Ea(e,a){var t=e.year,n=e.month,r=e.week,l=e.day;switch(a){case"YEAR":return t;case"MONTH":return va(t,n);case"WEEK":return"".concat(ba," ").concat(r," / ").concat(t);case"DAY":default:return va(t,n,l)}}function va(e,a,t){return da(t?new Date(e,a-1,t):new Date(e,a-1),t?ua.yyyymmdd:ua.yyyymm)}function da(e,a){var t=_.getState().locale||"en";return new Intl.DateTimeFormat(t,a).format(e)}var Oa=["#7cb5ec","#CC6600","#CCCC00","#66CC00","#ff0066","#000000","#00CCCC"],ga={animation:{duration:180},legend:{position:"bottom"},responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"nearest"},scales:{xAxes:[{display:!0,scaleLabel:{display:!0},ticks:{maxRotation:45,minRotation:45}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:h.a.t("Values")},ticks:{suggestedMin:0,precision:0}}]}},pa={backgroundColor:"rgba(0, 0, 0, 0)",fill:!1,lineTension:0};function ha(e,a){for(var t=e.aggregationLevel,n=e.category,r=e.chartType,l=e.interval,c=[],s=[],o=A[n].label,i=A[n].subtitle,u=1,b=null,E="FAVORITE_VIEWS"===n?ia[n][t][r]:ia[n],v=a.length,d=E.length,O=0;O<v;O++){var p=a[O];c.push(Ea(p,l));for(var h=0;h<d;h++){var y=E[h];0===O&&s.push(Object(g.a)({},pa,{label:y.label,data:[],borderColor:Oa[h]}));var m=p[y.key];m>u&&(u=m),(null===b||m<b)&&(b=m),s[h].data.push(m)}}return ga.scales.yAxes[0].ticks.suggestedMax=u,ga.scales.yAxes[0].ticks.suggestedMin=b,ga.onResize=Aa,{data:{labels:c,datasets:s},options:ga,title:o,subtitle:i}}function Aa(e){e.resize()}t(328);var ya=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="TOP_FAVORITES"===t.category||"ERROR"===a,r="LOADING"===a;return{shouldHide:n,loading:r,chartConfig:n||r?null:ha(t,a)}}))((function(e){var a,t=e.shouldHide,l=e.loading,c=e.chartConfig;if(t)return null;if(l)a=r.a.createElement(W.a,{overlay:!0});else{var s=c.options,o=c.data,i=c.title,u=c.subtitle;a=r.a.createElement(n.Fragment,null,r.a.createElement("h4",{className:"uaa-chart-title"},i),r.a.createElement("h6",{className:"uaa-chart-subtitle"},u),r.a.createElement("div",{className:"uaa-chart-wrap"},r.a.createElement(Se.a,{data:o,options:s})))}var b=l?"uua-data-container uua-chart-container uua-data-container--loading":"uua-data-container uua-chart-container";return r.a.createElement("div",{className:b},a)})),ma=(t(329),function(e){var a=e.headers;return r.a.createElement("thead",null,r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("th",{key:"h-".concat(a)},e)}))))}),fa=function(e){var a=e.rows;return r.a.createElement("tbody",null,a.map((function(e,a){return r.a.createElement(Da,{key:"row-".concat(a),cells:e})})))},Da=function(e){var a=e.cells;return r.a.createElement("tr",null,a.map((function(e,a){return r.a.createElement("td",{key:"cell-".concat(a)},e)})))};function Ta(e,a){var t=e.aggregationLevel,n=e.category,r=e.interval,l="FAVORITE_VIEWS"===n?oa[n][t]:oa[n];return{headers:l.map((function(e){return e.label})),rows:a.map((function(e){return l.map((function(a){return a.key===je.key?Ea(e,r):a.key===ta.key?(t=e[a.key],da(new Date(t),ua.yyyymmdd)):e[a.key];var t}))}))}}var Ra=Object(l.b)((function(e){var a=e.usageData,t=e.filter,n="ERROR"===a,r="LOADING"===a;return{error:n,loading:r,tableData:r||n?null:Ta(t,a)}}))((function(e){var a,t=e.error,n=e.loading,l=e.tableData;if(t)a=r.a.createElement(J,{message:h.a.t("There was an error retrieving the usage analytics data")});else if(n)a=r.a.createElement(W.a,{overlay:!0});else{var c=l.headers,s=l.rows;a=r.a.createElement("table",{className:"uaa-data-table"},r.a.createElement(ma,{headers:c}),r.a.createElement(fa,{rows:s}))}var o=n?"uua-data-container uua-data-container--loading":"uua-data-container";return r.a.createElement("div",{className:o},a)})),Sa=function(e){function a(){return Object(w.a)(this,a),Object(P.a)(this,Object(U.a)(a).apply(this,arguments))}return Object(L.a)(a,e),Object(F.a)(a,[{key:"componentDidMount",value:function(){this.props.initApp()}},{key:"render",value:function(){var e=this.props.appStatus;return"LOADING"===e?r.a.createElement(N.a,null,r.a.createElement(W.a,{large:!0})):"ERROR"===e?r.a.createElement(J,{message:h.a.t("Error loading application.")}):r.a.createElement("main",{className:"uaa-container"},r.a.createElement(Re,null),r.a.createElement("section",{className:"uaa-content"},r.a.createElement(ya,null),r.a.createElement(Ra,null)))}}]),a}(n.Component),ja=Object(l.b)((function(e){return{appStatus:e.appStatus}}),{initApp:function(){return function(e,a){var t;return G.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,G.a.awrap(I.getUsageData(a().filter));case 3:t=n.sent,e(B("APP_LOAD_SUCCESS",t)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e(B("APP_LOAD_ERROR",n.t0));case 10:case"end":return n.stop()}}),null,null,[[0,7]])}}})(Sa);t(330);a.default=function(){var e=Object(c.b)().baseUrl;return I.setBaseUrl(e),r.a.createElement(l.a,{store:_},r.a.createElement(ja,null))}}}]);
//# sourceMappingURL=app.b43d0bc9.chunk.js.map